-- DROP SCHEMA dbo;

CREATE SCHEMA dbo;
-- videoteca.dbo.AspNetRoles definition

-- videoteca.dbo.area definition

-- Drop table

-- DROP TABLE videoteca.dbo.area;

CREATE TABLE videoteca.dbo.area (
	id bigint IDENTITY(0,1) NOT NULL,
	nome nvarchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	CONSTRAINT area_pk PRIMARY KEY (id)
);


-- videoteca.dbo.status definition

-- Drop table

-- DROP TABLE videoteca.dbo.status;

CREATE TABLE videoteca.dbo.status (
	id bigint IDENTITY(0,1) NOT NULL,
	nome nvarchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	CONSTRAINT status_pk PRIMARY KEY (id)
);


-- videoteca.dbo.usuario definition

-- Drop table

-- DROP TABLE videoteca.dbo.usuario;

CREATE TABLE videoteca.dbo.usuario (
	id bigint IDENTITY(0,1) NOT NULL,
	nome nvarchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	email nvarchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	password nvarchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	permission bigint DEFAULT 1 NOT NULL,
	active bit DEFAULT 1 NOT NULL,
	CONSTRAINT usuario_pk PRIMARY KEY (id),
	CONSTRAINT usuario_unique UNIQUE (email)
);


-- videoteca.dbo.subarea definition

-- Drop table

-- DROP TABLE videoteca.dbo.subarea;

CREATE TABLE videoteca.dbo.subarea (
	id bigint IDENTITY(0,1) NOT NULL,
	nome nvarchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	id_area bigint NOT NULL,
	CONSTRAINT subarea_pk PRIMARY KEY (id),
	CONSTRAINT subarea_area_FK FOREIGN KEY (id_area) REFERENCES videoteca.dbo.area(id)
);


-- videoteca.dbo.video definition

-- Drop table

-- DROP TABLE videoteca.dbo.video;

CREATE TABLE videoteca.dbo.video (
	id bigint IDENTITY(0,1) NOT NULL,
	url nvarchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	titulo nvarchar(255) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	descricao nvarchar(4000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	active bit DEFAULT 1 NOT NULL,
	enviadoPor bigint NOT NULL,
	id_status bigint DEFAULT 0 NOT NULL,
	id_area bigint NOT NULL,
	id_subarea bigint NULL,
	aprovado bit DEFAULT 0 NOT NULL,
	enviadoEm datetime NOT NULL,
	CONSTRAINT video_pk PRIMARY KEY (id),
	CONSTRAINT video_area_FK FOREIGN KEY (id_area) REFERENCES videoteca.dbo.area(id),
	CONSTRAINT video_status_FK FOREIGN KEY (id_status) REFERENCES videoteca.dbo.status(id),
	CONSTRAINT video_subarea_FK FOREIGN KEY (id_subarea) REFERENCES videoteca.dbo.subarea(id),
	CONSTRAINT video_usuario_FK FOREIGN KEY (enviadoPor) REFERENCES videoteca.dbo.usuario(id)
);


-- videoteca.dbo.video_avaliacoes definition

-- Drop table

-- DROP TABLE videoteca.dbo.video_avaliacoes;

CREATE TABLE videoteca.dbo.video_avaliacoes (
	id_video bigint NOT NULL,
	id_avaliador bigint NOT NULL,
	justificativa nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	data_avaliacao datetime NULL,
	CONSTRAINT video_avaliacoes_pk PRIMARY KEY (id_video,id_avaliador),
	CONSTRAINT video_avaliacoes_usuario_FK FOREIGN KEY (id_avaliador) REFERENCES videoteca.dbo.usuario(id),
	CONSTRAINT video_avaliacoes_video_FK FOREIGN KEY (id_video) REFERENCES videoteca.dbo.video(id)
);


-- videoteca.dbo.usuarios_areas definition

-- Drop table

-- DROP TABLE videoteca.dbo.usuarios_areas;

CREATE TABLE videoteca.dbo.usuarios_areas (
	id_area bigint NOT NULL,
	id_usuario bigint NOT NULL,
	CONSTRAINT usuarios_areas_pk PRIMARY KEY (id_area,id_usuario),
	CONSTRAINT usuarios_areas_area_FK FOREIGN KEY (id_area) REFERENCES videoteca.dbo.area(id),
	CONSTRAINT usuarios_areas_usuario_FK FOREIGN KEY (id_usuario) REFERENCES videoteca.dbo.usuario(id)
);

INSERT INTO videoteca.dbo.status (nome) VALUES
	 ('Pendente'),
	 ('Recusado'),
	 ('Aprovado');